# Task list to configure the preferred system locale settings.
#
# Copyright 2025 林博仁(Buo-ren Lin) <buo.ren.lin@gmail.com>
# SPDX-License-Identifier: CC-BY-SA-4.0+

- name: Ensure the required locales are generated
  when: ansible_os_family == "Debian"
  become: true
  community.general.locale_gen:
    name:
      # Required by Ansible/Ansible Lint
      # This is not necessary for RedHat based systems as they have en_US.UTF-8
      # generated by default.
      - en_US.UTF-8

      - zh_TW.UTF-8

- name: Ensure that the Chinese locale data is installed on RedHat based systems
  when: ansible_os_family == "RedHat"
  become: true
  ansible.builtin.package:
    name:
      - glibc-langpack-zh

- name: Configure the preferred UI localization settings on RedHat based systems
  when: ansible_os_family == "RedHat"
  become: true
  ansible.builtin.lineinfile:
    path: /etc/locale.conf
    regexp: '^LANGUAGE='
    line: 'LANGUAGE="zh_TW:zh:en"'

- name: Configure preferred UI localization settings on Debian-based systems
  when: ansible_os_family == "Debian"
  become: true
  register: update_language
  changed_when: update_language.stdout != ""
  failed_when: update_language.rc != 0
  ansible.builtin.command:
    # Not an environment variable assignment
    # noqa: inline-env-var
    cmd: update-locale LANGUAGE=zh_TW:zh:en

- name: Ensure that the Chinese-localized manpages are installed
  become: true
  when: ansible_os_family == "Debian"
  ansible.builtin.package:
    name:
      - manpages-zh
